/*! { "name": "vissense-user-activity", "version": "0.0.0", "copyright": "(c) 2015 tbk" } */!function(a,b){"use strict";b(a,a.VisSense)}(this,function(a,b,c){"use strict";function d(b,c){f.forEach(b,function(b){b.call(c||a)})}function e(a){if(!(this instanceof e))return new e(a);this._config=h(a,{inactiveAfter:6e4,debounce:100,events:["resize","scroll","mousemove","mousewheel","keydown","mousedown","touchstart","touchmove"]}),this._listeners=[],this._clearTimeout=j,this._state={active:!0,changed:!1,lastActivityTime:k(),started:!1},this._setActive=function(a){this._state.changed=this._state.active!==a,this._state.active=a};var b=this;this._updateState=function(){var a=b.getTimeSinceLastActivity();a>=b._config.inactiveAfter?b._setActive(!1):(b._clearTimeout(),b._clearTimeout=function(a,b){var c=setTimeout(a,b);return function(){clearTimeout(c)}}(function(){b._updateState()},b._config.inactiveAfter)),d(b._listeners,b)},this._onUserActivity=function(){b._state.lastActivityTime=k(),b._setActive(!0),b._updateState()}}var f=b.Utils,g=f.debounce,h=f.defaults,i=f.isFunction,j=f.noop,k=f.now,l=b.VisMon.Strategy,m=function(a,b){var c=a.indexOf(b);return c>-1?(a.splice(c,1),!0):!1};e.prototype.start=function(){if(this._state.started)return this;var a=this;return this._removeEventListeners=function(){var b=g(a._onUserActivity,a._config.debounce),c=a._config.events;return f.forEach(c,function(a){addEventListener(a,b,!1)}),function(){f.forEach(c,function(a){removeEventListener(a,b,!1)})}}(),this._state.started=!0,this._onUserActivity(),this},e.prototype.stop=function(){return this._state.started?(this._removeEventListeners(),this._clearTimeout(),this._state.started=!1,this):this},e.prototype.onUpdate=function(a){if(!i(a))return j;var b=a.bind(c,this);this._listeners.push(b);var d=this;return function(){return m(d.listeners,b)}},e.prototype.onActive=function(a){var b=this;return this.onUpdate(function(){b._state.changed&&b._state.active&&a(b)})},e.prototype.onInactive=function(a){var b=this;return this.onUpdate(function(){b._state.changed&&!b._state.active&&a(b)})},e.prototype.isActive=function(){return!this._state.started||this._state.active},e.prototype.getTimeSinceLastActivity=function(){return k()-this._state.lastActivityTime},b.UserActivity=e,l.UserActivityStrategy=function(a){this._userActivity=new e(a),this.visibilityHook=function(){return this._userActivity.isActive()}},l.UserActivityStrategy.prototype=Object.create(l.prototype),l.UserActivityStrategy.prototype.init=function(a){this.removeVisibilityHook=function(b){var c=a.visobj()._config.visibilityHooks;return c.push(b.visibilityHook),function(){m(c,b.visibilityHook)}}(this)},l.UserActivityStrategy.prototype.start=function(){this._userActivity.start()},l.UserActivityStrategy.prototype.stop=function(){this.removeVisibilityHook(),this._userActivity.stop()}});