/*! { "name": "vissense-user-activity", "version": "0.0.0", "copyright": "(c) 2015 tbk" } */!function(a,b){"use strict";b(a,a.VisSense)}(this,function(a,b,c){"use strict";function d(b,c){j(b,function(b){b.call(c||a)})}function e(a){if(!(this instanceof e))return new e(a);this._config=i(a,{inactiveAfter:6e4,debounce:100,events:["resize","scroll","mousemove","mousewheel","keydown","mousedown","touchstart","touchmove"],active:l,inactive:l,update:l}),this._config.inactiveAfter-=1,this._listeners=[],this._clearTimeout=l,this._state={active:!0,lastActivityTime:m(),started:!1};var b=this;this._updateState=function(){var a=b.getTimeSinceLastActivity();a>=b._config.inactiveAfter?b._state.active=!1:(b._clearTimeout(),b._clearTimeout=h(function(){b._updateState()},b._config.inactiveAfter)),d(b._listeners,b)},this._onUserActivity=function(){b._state.lastActivityTime=m(),b._state.active=!0,b._updateState()},this.onUpdate(this._config.update),this.onActive(this._config.active),this.onInactive(this._config.inactive)}var f=b.Utils,g=f.debounce,h=f.defer,i=f.defaults,j=f.forEach,k=f.isFunction,l=f.noop,m=f.now,n=b.VisMon.Strategy,o=function(a,b){var c=a.indexOf(b);return c>-1?(a.splice(c,1),!0):!1};e.prototype.start=function(){return this._state.started?this:(this._removeEventListeners=function(a,b){var c=g(a,b.debounce),d=b.events;return j(d,function(a){addEventListener(a,c,!1)}),function(){j(d,function(a){removeEventListener(a,c,!1)})}}(this._onUserActivity,this._config),this._state.started=!0,this._onUserActivity(),this)},e.prototype.stop=function(){return this._state.started?(this._removeEventListeners(),this._clearTimeout(),this._state.started=!1,this):this},e.prototype.onUpdate=function(a){if(!k(a))return l;var b=a.bind(c,this);this._listeners.push(b);var d=this;return function(){return o(d.listeners,b)}},e.prototype.onActive=function(a){var b=this;return this.onUpdate(function(){b._state.active&&a(b)})},e.prototype.onInactive=function(a){var b=this;return this.onUpdate(function(){b._state.active||a(b)})},e.prototype.isActive=function(){return!this._state.started||this._state.active},e.prototype.getTimeSinceLastActivity=function(){return m()-this._state.lastActivityTime},b.UserActivity=e,n.UserActivityStrategy=function(a){this._userActivity=new e(a);var b=this;this.visibilityHook=function(){return b._userActivity.isActive()}},n.UserActivityStrategy.prototype=Object.create(n.prototype),n.UserActivityStrategy.prototype.init=function(a){this.removeVisibilityHook=function(b){var c=a.visobj()._config.visibilityHooks;return c.push(b.visibilityHook),function(){o(c,b.visibilityHook)}}(this),this.removeOnUpdateListener=this._userActivity.onUpdate(function(){a.update()})},n.UserActivityStrategy.prototype.start=function(){this._userActivity.start()},n.UserActivityStrategy.prototype.stop=function(){this.removeVisibilityHook(),this.removeOnUpdateListener(),this._userActivity.stop()}});